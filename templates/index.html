<!DOCTYPE html>
<html>

<head>
    <title>Flask Canvas App</title>
    <style></style>
    <style>
        canvas {
            border: 1px solid black;
        }
    </style>
    <script src="{{ url_for('static', filename='js/box.js') }}"></script>
    <script src="{{ url_for('static', filename='js/helpers.js') }}"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <h3 style="text-align: center;"> Frame <span id="curr-frame">0</span> / {{ frame_count }} </h3>
    <div id="sidebar">
        <button id="export-mot"> MOT </button> <br><br>
        <button id="next-image"> Next </button> <br><br>
        <button id="prev-image"> Prev </button> <br><br>
        <button id="select-image"> Select</button> <br><br>
    </div>
    <canvas id="myCanvas" width="{{ bg_width }}" height="{{ bg_height }}"></canvas>

    <script>
        // Load the background image onto the canvas
        var canvas = document.getElementById('myCanvas');
        canvas.tabIndex = 1000; // force canvas to listen to keyboard events
        var ctx = canvas.getContext('2d');
        var img = new Image();
        let mouseX, mouseY;
        let frame = -1;

        let squares = { [frame]: [] };
        loadImage("next");


        const exportButton = document.querySelector('#export-mot');
        exportButton.addEventListener('click', () => {
            exportToMOT("mot.txt");
        });

        const nextImageButton = document.querySelector('#next-image');
        nextImageButton.addEventListener('click', () => {
            loadImage("next");
        });


        const prevImageButton = document.querySelector('#prev-image');
        prevImageButton.addEventListener('click', () => {
            loadImage("prev");
        });

        const selectImageButton = document.querySelector('#select-image');
        selectImageButton.addEventListener('click', () => {
            let frame;
            while (frame = prompt("Select frame number: ")) {
                if (isNaN(frame)) {
                    alert("Not a number");
                } else {
                    break;
                }
            }
            loadSelectedImage(parseInt(frame));
        });

        document.addEventListener('keydown', function (event) {
            if (event.key === 'n') {
                loadImage('next');
            } else if (event.key === 'p') {
                loadImage('prev');
            }
        });


    </script>
    <script src="{{ url_for('static', filename='js/canvas-listeners.js') }}"></script>
</body>